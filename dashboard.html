<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <main>
        <h2>ðŸ“Š Resumo</h2>
        <div class="resumo">
            <div class="card verde">Ganhos <span id="tGanhos">R$ 0</span></div>
            <div class="card vermelho">Gastos <span id="tGastos">R$ 0</span></div>
            <div class="card azul">Saldo Atual <span id="saldo">R$ 0</span></div>
        </div>
        <div id="extrato"></div>
        <a href="index.html" style="display:block; text-align:center; margin-top:20px; color:#666; text-decoration:none;">Voltar</a>
    </main>

    <script type="module">
        import { db } from './firebase-config.js';
        import { collection, getDocs, query, orderBy, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore.js";

        window.excluir = async (id) => {
            if(confirm("Excluir?")) {
                await deleteDoc(doc(db, "transacoes", id));
                location.reload();
            }
        };

        async function carregar() {
            const q = query(collection(db, "transacoes"), orderBy("dataOcorrencia", "desc"));
            const snap = await getDocs(q);
            let g = 0, st = 0, h = "";
            snap.forEach(d => {
                const data = d.data();
                if(data.tipo === 'ganho') g += data.valor; else st += data.valor;
                h += `<div class="item-extrato">
                        <div class="info"><strong>${data.descricao}</strong><small>${data.dataOcorrencia}</small></div>
                        <div class="valor-box">R$ ${data.valor.toFixed(2)}<br>
                        <button class="btn-excluir" onclick="excluir('${d.id}')">Excluir</button></div>
                      </div>`;
            });
            document.getElementById('tGanhos').innerText = `R$ ${g.toFixed(2)}`;
            document.getElementById('tGastos').innerText = `R$ ${st.toFixed(2)}`;
            document.getElementById('saldo').innerText = `R$ ${(g-st).toFixed(2)}`;
            document.getElementById('extrato').innerHTML = h;
        }
        carregar();
    </script>
</body>
</html>
