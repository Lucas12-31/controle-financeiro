<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Financeiro</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <main class="wide">
        <h2>ðŸ“Š Resumo Geral</h2>
        <div class="resumo">
            <div class="card verde">Ganhos: <span id="totalGanhos">R$ 0</span></div>
            <div class="card vermelho">Gastos: <span id="totalGastos">R$ 0</span></div>
            <div class="card azul">Saldo: <span id="saldo">R$ 0</span></div>
        </div>

        <h3>Extrato Detalhado</h3>
        <div id="extrato">
            </div>
        
        <a href="index.html" class="btn-voltar">Voltar ao Menu</a>
    </main>

    <script type="module">
        import { db } from './firebase-config.js';
        import { collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore.js";

        async function carregarDados() {
            const q = query(collection(db, "transacoes"), orderBy("dataOcorrencia", "desc"));
            const querySnapshot = await getDocs(q);
            
            let tGanhos = 0, tGastos = 0, html = "";

            querySnapshot.forEach((doc) => {
                const d = doc.data();
                if(d.tipo === 'ganho') tGanhos += d.valor;
                else tGastos += d.valor;

                // Aqui montamos a linha do extrato com Local e Categoria se houver
                html += `
                    <div class="item-extrato ${d.tipo}">
                        <div class="info">
                            <strong>${d.descricao}</strong>
                            <span>${d.categoria || 'Ganho'} | ${d.local || 'Geral'}</span>
                            <small>${d.dataOcorrencia}</small>
                        </div>
                        <div class="valor">R$ ${d.valor.toFixed(2)}</div>
                    </div>`;
            });

            document.getElementById('totalGanhos').innerText = `R$ ${tGanhos.toFixed(2)}`;
            document.getElementById('totalGastos').innerText = `R$ ${tGastos.toFixed(2)}`;
            document.getElementById('saldo').innerText = `R$ ${(tGanhos - tGastos).toFixed(2)}`;
            document.getElementById('extrato').innerHTML = html;
        }

        carregarDados();
    </script>
</body>
</html>
